<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.beans.roaststars.model.mapper.AdminMapper">


	<!-- 가입한 아이디 중, 사장 권한 부여를 받기 위해 대기 중인 user의 리스트 반환 -->
	<select id="getAllWaitingForUpgradeUserList" resultType="userVO">
		select
		rs.id,rs.name, business_name,business_no,business_pic, au.authority,
		enabled
		from rs_user rs, authorities au
		where rs.id = au.username
		and not
		business_name is null
		and not business_no is null
		and not business_pic
		is null
		and authority='ROLE_MEMBER'
	</select>

	<!-- 멤버 권한 종류가져오기 -->
	<select id="getUserAuthorityList" resultType="String">
		select
		distinct(authority)
		from authorities
	</select>
	
	<!-- 총 권한 대기 회원 수 -->
	<select id="getTotalCountByWaitingMember" resultType="int">
		SELECT
		COUNT(*)
		from authorities
		where authority='ROLE_MEMBER'
	</select>

 	<!--  has a 관계를 위한 userVO resultMap--> 
	<resultMap type="authorityVO" id="adminUserRM">
		<result property="userVO.id" column="id" />
	</resultMap>

	<!--  카페 넘버에 해당하는 리뷰 리스트 목록 조회-->
	<select id="findMemberByAuthority" parameterType="map"
		resultMap="adminUserRM">
		SELECT au.authority, au.username, rs.id
		FROM(SELECT
		row_number() over (order by authority desc) as rnum, username,
		authority from authorities) au, rs_user rs
		where rs.id=au.username and
		rnum between #{pagingBean.startRowNumber} and
		#{pagingBean.endRowNumber}
	</select>
	
 


</mapper>
